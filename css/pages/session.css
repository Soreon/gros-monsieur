/* ==========================================================================
   session.css — Live workout session overlay
   Gros Monsieur fitness PWA
   Depends on: css/variables.css, css/layout.css, css/components.css

   The host element is #session-overlay (.session-overlay in layout.css):
     position: fixed; inset: 0; overflow-y: auto; z-index: var(--z-session);
     background: var(--bg);
   This file styles all content inside it via .session and its descendants.
   ========================================================================== */


/* ==========================================================================
   1. SESSION WRAPPER
   ========================================================================== */

/**
 * Root flex column that fills the full overlay height.
 * Bottom padding creates clearance above the bottom nav (which is still
 * rendered behind the overlay) plus the device safe area.
 */
.session {
  min-height: 100%;
  display: flex;
  flex-direction: column;
  padding-bottom: calc(var(--nav-height) + var(--safe-bottom) + var(--space-8));
}


/* ==========================================================================
   2. STICKY SESSION HEADER
   ========================================================================== */

/**
 * Sticks to the top of the overlay while the user scrolls.
 * Height accounts for the device's safe-area-inset-top (notch / status bar).
 */
.session__header {
  position: sticky;
  top: 0;
  z-index: 2;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  padding-top: calc(var(--space-3) + var(--safe-top));
  height: calc(56px + var(--safe-top));
  box-sizing: border-box;
}

/**
 * Minimize and reset icon buttons.
 * 40×40 tap targets with a fully-rounded shape; transparent background so
 * they appear to float on the header surface.
 */
.session__btn-minimize,
.session__btn-reset {
  width: 40px;
  height: 40px;
  border-radius: var(--radius-full);
  background: transparent;
  border: none;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: opacity 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session__btn-minimize:hover,
.session__btn-minimize:active,
.session__btn-reset:hover,
.session__btn-reset:active {
  opacity: 0.7;
}

/**
 * Global session timer displayed in the centre of the header.
 * Tabular numerals prevent the layout from jumping as digits change.
 */
.session__timer {
  flex: 1;
  text-align: center;
  font-size: var(--text-xl);
  font-weight: var(--fw-bold);
  font-variant-numeric: tabular-nums;
  letter-spacing: -0.5px;
  color: var(--text);
}

/**
 * "Finish" call-to-action — danger colour to signal the destructive end-of-session
 * action without being alarming during an active session.
 */
.session__btn-finish {
  height: 36px;
  padding: 0 var(--space-4);
  background: var(--danger);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  font-size: var(--text-sm);
  font-weight: var(--fw-bold);
  letter-spacing: 0.04em;
  cursor: pointer;
  flex-shrink: 0;
  transition: opacity 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session__btn-finish:hover,
.session__btn-finish:active {
  opacity: 0.85;
}


/* ==========================================================================
   3. SESSION TITLE ROW  (below header, non-sticky)
   ========================================================================== */

/**
 * Workout / routine name and a per-exercise rest timer displayed side by side.
 * Sits just below the sticky header; scrolls with the page content.
 */
.session__title-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-3) var(--space-4) var(--space-2);
  gap: var(--space-3);
}

/* Workout name — truncated if too long */
.session__name {
  font-size: var(--text-base);
  font-weight: var(--fw-semi);
  color: var(--text);
  flex: 1;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* Optional rest / inter-set timer beside the name */
.session__name-timer {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  font-variant-numeric: tabular-nums;
  flex-shrink: 0;
}


/* ==========================================================================
   4. SESSION CONTENT AREA
   ========================================================================== */

/**
 * Grows to fill all remaining vertical space between the title row and the
 * bottom actions block.
 */
.session__content {
  flex: 1;
  padding: 0 0 var(--space-8);
}


/* ==========================================================================
   5. EXERCISE BLOCK
   ========================================================================== */

/**
 * Groups the header, note textarea, and sets table for a single exercise.
 * Bottom margin separates consecutive exercise blocks.
 */
.session-exercise {
  margin-bottom: var(--space-4);
}

/**
 * Exercise header bar — coloured icon, name, and any trailing controls.
 * Elevated background distinguishes it from the white-space set rows below.
 */
.session-exercise__header {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3) var(--space-4);
  border-top: 1px solid var(--border-strong);
  border-bottom: 1px solid var(--border);
  background: var(--bg-surface);
}

/**
 * Coloured square icon (emoji, letter, or muscle-group colour).
 * Background colour is set inline by JS based on exercise metadata.
 */
.session-exercise__icon {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--fw-bold);
  font-size: var(--text-sm);
}

/* Exercise name — truncated to one line */
.session-exercise__name {
  flex: 1;
  font-size: var(--text-base);
  font-weight: var(--fw-semi);
  color: var(--text);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  min-width: 0;
}

/**
 * Per-exercise free-text note.
 * Stretches full-width under the header; autogrows up to max-height via JS.
 * Transparent background keeps it visually inline; accent focus line signals
 * editable state.
 */
.session-exercise__note {
  width: 100%;
  box-sizing: border-box;
  background: transparent;
  border: none;
  border-bottom: 1px solid var(--border);
  padding: var(--space-2) var(--space-4);
  min-height: 36px;
  max-height: 80px;
  resize: none;
  color: var(--text);
  font-size: var(--text-sm);
  font-family: inherit;
  outline: none;
  display: block;
}

.session-exercise__note:focus {
  border-bottom-color: var(--accent);
}

.session-exercise__note::placeholder {
  color: var(--text-disabled);
}


/* ==========================================================================
   6. SETS TABLE
   ========================================================================== */

/* Padded wrapper that aligns with the page horizontal rhythm */
.session-sets {
  padding: 0 var(--space-4);
}

/**
 * Column header row — uppercase, small, secondary colour.
 * Column widths match the set rows below (flex + fixed widths must be in sync).
 */
.session-sets__header {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) 0;
  margin-bottom: var(--space-1);
  border-bottom: 1px solid var(--border);
  font-size: var(--text-xs);
  font-weight: var(--fw-bold);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--text-secondary);
}

/* --- Column width tokens (shared by header and set rows) --- */

/* Set number / type badge */
.session-sets__col-set {
  min-width: 36px;
  text-align: center;
}

/* Previous-session reference value */
.session-sets__col-prev {
  flex: 1.2;
  text-align: center;
}

/* Weight (kg) input */
.session-sets__col-kg {
  flex: 1;
  text-align: center;
}

/* Reps input */
.session-sets__col-reps {
  flex: 1;
  text-align: center;
}

/* Done checkmark button */
.session-sets__col-check {
  width: 44px;
  text-align: center;
}

/* --- Individual set row --- */

/**
 * Each row contains: type badge | prev reference | kg input | reps input | check.
 * Smooth background transition used for the --done state.
 */
.session-set-row {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) 0;
  border-bottom: 1px solid var(--border);
  transition: background 0.15s;
}

.session-set-row:last-of-type {
  border-bottom: none;
}

/**
 * Completed set — green tint background; inputs dimmed to indicate the
 * values are locked in (user can still edit them).
 */
.session-set-row--done {
  background: var(--success-dim);
}

.session-set-row--done .session-set-row__input {
  opacity: 0.6;
}

/**
 * Set-type badge button — cycles through normal / warmup / drop on tap.
 * Matches the appearance of .sets-editor__set-type from entrainement.css
 * so the two surfaces feel consistent.
 */
.session-set-row__type {
  min-width: 36px;
  height: 36px;
  border-radius: var(--radius-sm);
  font-size: var(--text-xs);
  font-weight: var(--fw-bold);
  text-align: center;
  line-height: 36px;
  background: var(--bg-input);
  color: var(--text);
  border: none;
  cursor: pointer;
  flex-shrink: 0;
}

/* Warm-up variant */
.session-set-row__type.type-warmup {
  background: var(--warning-dim);
  color: var(--warning);
}

/* Drop set variant */
.session-set-row__type.type-drop {
  background: var(--danger-dim);
  color: var(--danger);
}

/**
 * Previous-session reference value — read-only ghost text.
 * Tabular numerals prevent column jitter when values differ in width.
 */
.session-set-row__prev {
  flex: 1.2;
  text-align: center;
  font-size: var(--text-xs);
  color: var(--text-disabled);
  font-variant-numeric: tabular-nums;
}

/**
 * Weight / reps numeric inputs.
 * Large centred font for fast eyes-down data entry.
 * Spin buttons are hidden — users tap +/- or type directly.
 */
.session-set-row__input {
  flex: 1;
  min-width: 0;
  height: 36px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--text);
  font-size: var(--text-base);
  text-align: center;
  padding: 0 var(--space-1);
  outline: none;
  box-sizing: border-box;
  transition: border-color 0.15s;
}

.session-set-row__input:focus {
  border-color: var(--accent);
}

/* Hide number-input spin buttons — all browsers */
.session-set-row__input[type="number"] {
  appearance: textfield;
  -moz-appearance: textfield;
}

.session-set-row__input[type="number"]::-webkit-inner-spin-button,
.session-set-row__input[type="number"]::-webkit-outer-spin-button {
  display: none;
}

/**
 * Checkmark button — marks a set as done.
 * Scales down on press for tactile feedback.
 */
.session-set-row__check {
  width: 44px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  background: transparent;
  cursor: pointer;
  flex-shrink: 0;
  font-size: 24px;
  color: var(--text-disabled);
  transition: color 0.15s, transform 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session-set-row__check--checked {
  color: var(--success);
}

.session-set-row__check:active {
  transform: scale(0.9);
}

/**
 * PR (personal record) badge — appears inline beside the check when the
 * logged weight/reps exceeds all previous bests.
 */
.session-set-row__pr {
  font-size: var(--text-xs);
  font-weight: var(--fw-bold);
  color: var(--warning);
  background: var(--warning-dim);
  border-radius: var(--radius-full);
  padding: 1px var(--space-1);
  white-space: nowrap;
}


/* ==========================================================================
   7. ADD SET BUTTON
   ========================================================================== */

/**
 * Ghost text button at the bottom of a set list.
 * Full-width so the tap target is generous; accent colour on interaction.
 */
.session-add-set {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  width: 100%;
  height: 44px;
  margin-top: var(--space-2);
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: var(--text-sm);
  font-weight: var(--fw-semi);
  cursor: pointer;
  letter-spacing: 0.04em;
  transition: color 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session-add-set:hover,
.session-add-set:active {
  color: var(--accent);
}


/* ==========================================================================
   8. BOTTOM ACTIONS
   ========================================================================== */

/**
 * Container for the two end-of-session actions (add exercise + cancel).
 * Placed after all exercise blocks and before the window's padding-bottom.
 */
.session__bottom-actions {
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

/**
 * "Add exercise" button — dashed border indicates an additive action;
 * accent on hover mirrors the sets-editor equivalent.
 */
.session-add-exercise {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  width: 100%;
  height: 52px;
  background: var(--bg-surface);
  border: 1px dashed var(--border);
  border-radius: var(--radius-md);
  color: var(--text-secondary);
  font-size: var(--text-sm);
  font-weight: var(--fw-semi);
  cursor: pointer;
  box-sizing: border-box;
  transition: border-color 0.15s, color 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session-add-exercise:hover,
.session-add-exercise:active {
  border-color: var(--accent);
  color: var(--accent);
}

/**
 * "Cancel session" — danger text, lower opacity at rest so it doesn't
 * compete with the finish button in the header.
 */
.session-cancel {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 44px;
  background: transparent;
  border: none;
  color: var(--danger);
  font-size: var(--text-sm);
  font-weight: var(--fw-semi);
  cursor: pointer;
  letter-spacing: 0.04em;
  opacity: 0.7;
  transition: opacity 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session-cancel:hover,
.session-cancel:active {
  opacity: 1;
}


/* ==========================================================================
   9. SESSION SUMMARY MODAL
   ========================================================================== */

/**
 * Bottom-sheet modal shown when the user taps "Finish".
 * Extends the base .modal from layout.css:
 *   background: var(--bg-surface); border-radius: var(--radius-xl) var(--radius-xl) 0 0;
 * Overrides max-height for a taller, summary-optimised sheet.
 * Used inside a .modal-overlay (position: fixed, z-index: var(--z-modal)).
 */
.session-summary {
  background: var(--bg-surface);
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
  width: 100%;
  max-width: var(--max-width);
  max-height: 90dvh;
  max-height: 90vh; /* fallback */
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  position: absolute;
  bottom: 0;
  left: 0;
}

/* Centred header with workout-complete headline */
.session-summary__header {
  padding: var(--space-4);
  text-align: center;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}

.session-summary__title {
  font-size: var(--text-xl);
  font-weight: var(--fw-bold);
  color: var(--text);
}

/**
 * Key stats row (duration, volume, sets, PRs…).
 * Space-around distribution fills the width regardless of stat count.
 */
.session-summary__stats {
  display: flex;
  gap: var(--space-4);
  padding: var(--space-4);
  border-bottom: 1px solid var(--border);
  justify-content: space-around;
  text-align: center;
  flex-shrink: 0;
}

/* Label above the numeric value */
.session-summary__stat-label {
  display: block;
  font-size: var(--text-xs);
  font-weight: var(--fw-bold);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--text-secondary);
  margin-bottom: var(--space-1);
}

/* The stat number itself */
.session-summary__stat-value {
  display: block;
  font-size: var(--text-lg);
  font-weight: var(--fw-bold);
  color: var(--text);
}

/**
 * Scrollable exercise recap list.
 * max-height caps it so the footer close button is always visible.
 */
.session-summary__exercises {
  overflow-y: auto;
  max-height: 40vh;
  padding: var(--space-4);
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
  flex: 1;
}

/* One exercise recap item — icon + text block */
.session-summary__ex-item {
  display: flex;
  align-items: flex-start;
  gap: var(--space-3);
}

/* Mirrors .session-exercise__icon */
.session-summary__ex-icon {
  width: 32px;
  height: 32px;
  border-radius: var(--radius-sm);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--fw-bold);
  font-size: var(--text-sm);
}

/* Exercise name in the recap */
.session-summary__ex-name {
  font-weight: var(--fw-semi);
  color: var(--text);
  font-size: var(--text-sm);
}

/* Best set or volume summary beneath the name */
.session-summary__ex-best {
  font-size: var(--text-xs);
  color: var(--text-secondary);
  margin-top: 2px;
}

/**
 * Footer — always visible at the bottom.
 * Safe-area padding ensures the close button clears the home indicator.
 */
.session-summary__footer {
  padding: var(--space-4);
  padding-bottom: calc(var(--space-4) + var(--safe-bottom));
  border-top: 1px solid var(--border);
  flex-shrink: 0;
}

/* Primary close / save CTA */
.session-summary__close-btn {
  display: block;
  width: 100%;
  height: 52px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: var(--radius-md);
  font-size: var(--text-base);
  font-weight: var(--fw-bold);
  letter-spacing: 0.05em;
  cursor: pointer;
  transition: opacity 0.15s;
  -webkit-tap-highlight-color: transparent;
}

.session-summary__close-btn:hover,
.session-summary__close-btn:active {
  opacity: 0.85;
}


/* ==========================================================================
   10. TOAST ADDITIONS
   ========================================================================== */

/*
 * NOTE: .toast-container and .toast base styles are defined in layout.css.
 * Only additions / variants that are not already present are defined here.
 *
 * layout.css already provides:
 *   .toast-container  — fixed top-centre, z-index: var(--z-toast)
 *   .toast            — bg-elevated, border-strong, box-shadow, animation
 *   .toast--success   — border-color + color: var(--success)
 *   .toast--error     — border-color + color: var(--danger)
 *
 * Added here:
 *   .toast--visible   — explicit visible state (for JS-driven opacity toggle)
 *   .toast--warning   — warning colour variant (missing from layout.css)
 *
 * If the session overlay needs bottom-anchored toasts (above the nav) rather
 * than the default top position, swap .toast-container for
 * .toast-container--bottom defined below.
 */

/* Explicit visible state — JS adds this class after inserting the element */
.toast--visible {
  opacity: 1;
  transform: translateY(0);
}

/* Warning variant — matches .toast--success pattern */
.toast--warning {
  border-left: 3px solid var(--warning);
  color: var(--warning);
}

/**
 * Alternative bottom-anchored toast container used inside the session overlay.
 * Sits above the bottom nav + safe area so it never overlaps controls.
 * Add this class alongside (or instead of) .toast-container when the session
 * needs its own notification stack.
 */
.toast-container--bottom {
  position: fixed;
  bottom: calc(var(--nav-height) + var(--safe-bottom) + var(--space-3));
  top: auto;
  left: var(--space-4);
  right: var(--space-4);
  transform: none;
  z-index: var(--z-toast);
  display: flex;
  flex-direction: column;
  align-items: stretch;
  pointer-events: none;
  gap: var(--space-2);
}
